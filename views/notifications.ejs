<%- include('partials/header') %>





<form method="GET" action="/notifications">
  <label>ุนุฏุฏ ุงูุฃูุงู ุงูุชู ุชุนุชุจุฑ ุงูููุชุฌ ุฑุงูุฏูุง:</label>
  <input type="number" name="limit" value="<%= limitDays %>" min="1" />
  <button type="submit">ุชุญุฏูุซ</button>
</form>

<div class="alert-list">
<% if ((lowStock && lowStock.length) || 
       (expired && expired.length) || 
       (inactive && inactive.length)) { %>
  <% lowStock.forEach(p => { %>
  <div class="alert-item" style="border-left-color:#ffc107;">
    <span class="alert-icon">โ๏ธ</span>
    <div class="alert-text">ุงููููุฉ ููุฎูุถุฉ ูููุชุฌ "<%= p.name %>"</div>
    <span class="alert-date">ุงููุชุจูู <%= p.qty %></span>
  </div>
  <% }) %>

  <% expired.forEach(p => { %>
  <div class="alert-item" style="border-left-color:#f44336;">
    <span class="alert-icon">โณ</span>
    <div class="alert-text">ุตูุงุญูุฉ "<%= p.name %>" ููุชููุฉ ููุฐ ูุฏุฉ</div>
    <span class="alert-date"><%= p.expiryDate %></span>
  </div>
  <% }); %>











<% 
  const now = new Date();
  products.forEach(p => {
    const lastDate = p.lastSold ? new Date(p.lastSold) : null;
    const stagnantLimit = typeof limitDays !== 'undefined' ? limitDays : 14;

    if (!lastDate) {
%>
  <div class="alert-item" style="border-left-color:#886CE4;">
    <span class="alert-icon">๐</span>
    <div class="alert-text">ููุชุฌ <%= p.name %> ูู ูุชู ุจูุนู ุจุนุฏ</div>
    <span class="alert-date">๐ฆ ุฌุฏูุฏ ูู ุงููุฎุฒูู</span>
  </div>
<% 
    } else {
      const diffDays = Math.floor((now - lastDate) / (1000 * 60 * 60 * 24));
      if (diffDays >= stagnantLimit) {
%>
  <div class="alert-item" style="border-left-color:#03a9f4;">
    <span class="alert-icon">๐</span>
    <div class="alert-text">
      ููุชุฌ <%= p.name %> ูู ููุจุน ููุฐ <%= diffDays >= 30 ? "ุดูุฑ ุชูุฑูุจูุง" : diffDays + " ููู" %>
    </div>
    <span class="alert-date">ููุฐ <%= diffDays %> ููู</span>
  </div>
<%
      }
    }
  });
%>

  <% } else { %>
  <div class="alert-list">
    <div class="alert-item">
      <span class="alert-icon">โ</span>
      <div class="alert-text">ูุง ุชูุฌุฏ ุชูุจููุงุช ุญุงููุงูุ ููุดู ุชูุงู ๐</div>
      <span class="alert-date">ุงูุขู</span>
    </div>
  </div>
<% } %>
</div>





<%- include('partials/footer') %>
